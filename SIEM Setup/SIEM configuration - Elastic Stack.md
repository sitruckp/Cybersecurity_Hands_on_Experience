# üõ°Ô∏è Elastic SIEM Stack Setup & Secure Configuration (Linux)

This document details the successful installation, configuration, and troubleshooting steps required to launch the Elastic Stack (Elasticsearch and Kibana) with security enabled on a Linux system. This foundation is necessary for deploying Elastic's Security Information and Event Management (SIEM) features.

## Prerequisites

* Elasticsearch and Kibana installed (e.g., via `.deb` or `apt`).
* System running on a Linux distribution (e.g., Ubuntu).

***

## 1. Initial Service and Security Activation

The primary goal was to ensure both Elasticsearch and Kibana services start and communicate securely using HTTPS and mandatory authentication.

### 1.1 Start Elasticsearch and Enable Security

Elasticsearch was initialized, which automatically enables security (`xpack.security.enabled: true`) in modern distributions.

```bash
# Start the Elasticsearch service
sudo systemctl start elasticsearch

# Check the status (should show 'active (running)')
sudo systemctl status elasticsearch

1.2 Set Passwords for Built-in Users

The password for the highly privileged elastic user was set to secure the initial connection.

# Execute the password setup tool
sudo /usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive

User: elastic

    Password Used: 	PASSWORD (Used consistently for the web login)

2. Kibana Configuration

The core of the issue involved correctly configuring Kibana to connect to the secure Elasticsearch cluster. This required setting the connection endpoint (HTTPS) and the correct system credentials.

2.1 Create Minimal Kibana Configuration File

The default configuration file was replaced with a minimal, clean file to eliminate extraneous settings that caused validation errors.

# Stop Kibana and delete the old configuration
sudo systemctl stop kibana
sudo rm /etc/kibana/kibana.yml

# Create new minimal configuration with the correct settings
echo -e "server.host: \"localhost\"\nelasticsearch.hosts: [\"https://localhost:9200\"]\nelasticsearch.username: \"kibana_system\"\nelasticsearch.password: \"PASSWORD\"\nelasticsearch.ssl.verificationMode: none" | sudo tee /etc/kibana/kibana.yml

2.2 Corrected Configuration File Content

The final, working configuration included the following parameters:

server.host: "localhost"
elasticsearch.hosts: ["https://localhost:9200"]
elasticsearch.username: "kibana_system"
elasticsearch.password: "PASSWORD"
elasticsearch.ssl.verificationMode: none

3. Resolving Critical Startup Errors

The setup required several critical fixes related to user permissions and specific Elastic Stack security requirements.

3.1 Resolving Kibana Data/Log Directory Permissions

Initial startup failed due to file ownership issues with the Kibana directories.

# Ensure kibana user owns the necessary directories
sudo chown -R kibana:kibana /var/lib/kibana
sudo chown -R kibana:kibana /var/log/kibana

3.2 Fixing Forbidden Username Error (status=78)

Kibana crashed because the configuration initially used the forbidden elastic user for the background service connection. This was corrected to the dedicated system user.

Initial Error: Error: [config validation of [elasticsearch].username]: value of "elastic" is forbidden.

Resolution: Changed elasticsearch.username from elastic to the correct service user, kibana_system.

3.3 Fixing Authentication Error (security_exception)

The final error was a password mismatch for the kibana_system user. The password was reset in Elasticsearch to an autogenerated value, and the Kibana configuration was updated to match.

Reset kibana_system Password (Autogenerated)

sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u kibana_system

New Autogenerated Password: PASSWORD

Update Kibana Configuration to Match

# Update kibana.yml with the new autogenerated password
sudo sed -i 's/elasticsearch.password: "OLD_PASSWORD"/elasticsearch.password: "PASSWORD"/' /etc/kibana/kibana.yml

4. Final Service Startup and Access

The Kibana service was successfully started and maintained a stable connection to Elasticsearch.

# Final Kibana service start
sudo systemctl start kibana

# Final status check (should show 'active (running)' with no security errors)
sudo systemctl status kibana

Access Credentials

The Kibana web interface is now accessible and secured.

Component,URL,Username,Password
Kibana Web UI,http://localhost:5601,elastic,PASSWORD
Kibana Service,N/A,kibana_system,PASSWORD

Next Step

The next logical step for SIEM deployment is configuring an Elastic Agent or Filebeat to ingest operating system logs (e.g., system and security logs) into Elasticsearch, which can then be viewed in the Kibana Security application.
